# 常见错误排查指南

## 🔍 如何查看错误信息

### 1. 浏览器控制台

- 按 `F12` 打开开发者工具
- 点击 "Console" (控制台) 标签
- 查看红色的错误信息

### 2. 终端

- 查看运行 `pnpm dev` 的终端窗口
- 查看是否有编译错误

## ❌ 常见错误及解决方案

### 错误 1: Module not found

**错误信息**:

```
Module not found: Can't resolve 'xxx'
```

**原因**: 缺少依赖包

**解决方案**:

```bash
cd web
pnpm install
```

---

### 错误 2: React Hook 依赖警告

**错误信息**:

```
React Hook useEffect has missing dependencies
```

**原因**: useEffect 依赖项不完整

**解决方案**: 已在最新代码中修复，刷新页面即可

---

### 错误 3: 钱包连接错误

**错误信息**:

```
Failed to connect wallet
```

**原因**:

- 未安装 MetaMask
- 钱包被锁定
- 网络错误

**解决方案**:

1. 安装 MetaMask 浏览器插件
2. 解锁钱包
3. 刷新页面重试

---

### 错误 4: 余额查询错误

**错误信息**:

```
Error fetching balance
could not coalesce error
```

**原因**: 合约还没准备好

**解决方案**:

1. 等待几秒钟
2. 点击刷新按钮 🔄
3. 如果持续失败，刷新页面

---

### 错误 5: 交易失败 - UNSUPPORTED_OPERATION

**错误信息**:

```
contract runner does not support sending transactions
code=UNSUPPORTED_OPERATION
```

**原因**: 钱包未连接或未解锁

**解决方案**:

1. 确保钱包已连接
2. 确保钱包已解锁
3. 刷新页面重新连接

---

### 错误 6: 交易失败 - user rejected

**错误信息**:

```
user rejected transaction
```

**原因**: 用户在 MetaMask 中拒绝了交易

**解决方案**: 这是正常的，重新操作并在 MetaMask 中点击"确认"

---

### 错误 7: 交易失败 - insufficient funds

**错误信息**:

```
insufficient funds for gas
```

**原因**: ETH 余额不足支付 Gas 费

**解决方案**:

1. 从水龙头获取 Sepolia ETH
2. 确保钱包有足够的 ETH

---

### 错误 8: 网络错误

**错误信息**:

```
Network Error
Failed to fetch
```

**原因**:

- 网络连接问题
- RPC 节点问题
- 防火墙拦截

**解决方案**:

1. 检查网络连接
2. 切换到其他 RPC 节点
3. 关闭 VPN 或代理

---

### 错误 9: 编译错误

**错误信息**:

```
Failed to compile
```

**原因**: 代码语法错误

**解决方案**:

1. 查看终端的具体错误信息
2. 检查最近修改的代码
3. 运行 `pnpm install` 重新安装依赖

---

### 错误 10: Port already in use

**错误信息**:

```
Port 3000 is already in use
```

**原因**: 端口被占用

**解决方案**:

```bash
# Windows
netstat -ano | findstr :3000
taskkill /PID <PID> /F

# 或者修改端口
# 在 vite.config.ts 中修改 port: 3001
```

---

## 🔧 通用解决步骤

遇到任何错误时，按以下步骤尝试：

1. **查看完整错误信息**

   - 打开浏览器控制台 (F12)
   - 查看终端输出

2. **刷新页面**

   - 按 `Ctrl + Shift + R` 强制刷新
   - 清除浏览器缓存

3. **重启开发服务器**

   ```bash
   # 按 Ctrl + C 停止
   pnpm dev
   ```

4. **重新安装依赖**

   ```bash
   rm -rf node_modules
   pnpm install
   ```

5. **检查网络和钱包**

   - 确保在 Sepolia 测试网
   - 确保钱包已连接并解锁
   - 确保有足够的 ETH 余额

6. **查看日志**
   - 浏览器控制台的日志
   - 终端的错误信息
   - MetaMask 的错误提示

## 📝 报告错误

如果以上方法都无法解决，请提供以下信息：

1. **完整的错误信息** (截图或复制文字)
2. **浏览器和版本** (如 Chrome 120)
3. **操作步骤** (如何复现错误)
4. **控制台日志** (F12 控制台的输出)

## 🆘 调试技巧

### 查看详细日志

在浏览器控制台输入：

```javascript
localStorage.setItem("debug", "*")
```

### 检查钱包状态

```javascript
console.log("Connected:", window.ethereum?.selectedAddress)
console.log("Network:", window.ethereum?.chainId)
```

### 检查合约地址

```javascript
console.log("Contracts:", {
  SwapRouter: "0xD2c220143F5784b3bD84ae12747d97C8A36CeCB2",
  PositionManager: "0xbe766Bf20eFfe431829C5d5a2744865974A0B610",
  PoolManager: "0xddC12b3F9F7C91C79DA7433D8d212FB78d609f7B"
})
```

---

## ✅ 健康检查清单

启动应用前检查：

- [ ] Node.js 版本 >= 16
- [ ] 已安装 pnpm
- [ ] 已运行 `pnpm install`
- [ ] 端口 3000 未被占用
- [ ] MetaMask 已安装
- [ ] 网络已切换到 Sepolia
- [ ] 钱包有测试 ETH

运行应用时检查：

- [ ] 开发服务器正常启动
- [ ] 浏览器打开 http://localhost:3000
- [ ] 页面正常显示
- [ ] 能连接钱包
- [ ] 能查看余额
- [ ] 控制台无严重错误

---

**最后更新**: 2025-10-22  
**需要帮助？** 提供完整错误信息以获得更好的支持！
