# 更新日志

## [1.0.0] - 2025-10-22

### 新增功能 ✨

- ✅ 完整的 DEX 前端应用
- ✅ Swap (代币交换) 功能
- ✅ Liquidity (流动性管理) 功能
- ✅ Positions (持仓查看) 功能
- ✅ **费率选择功能** - 支持 0.05%, 0.30%, 1.00% 三种费率
- ✅ 钱包连接 (MetaMask 等)
- ✅ 实时余额显示
- ✅ 交易报价预览
- ✅ 代币授权管理

### 问题修复 🐛

- ✅ **修复钱包连接无响应问题**

  - 添加了异步处理
  - 增加了错误提示
  - 改进了用户反馈

- ✅ **修复余额获取死循环问题** (2025-10-23)

  - 问题：控制台不断打印 "Already fetching balance, skipping..."
  - 原因：React Hooks 依赖循环导致无限重渲染
  - 修复：在 `useTokenContract` 中添加缓存机制
  - 优化：`useTokenBalance` 移除循环依赖
  - 结果：余额只在真正需要时获取，不再无限循环

- ✅ **修复 Swap 自动报价功能** (2025-10-23)
  - 问题：输入 TokenA 数量后，不会自动计算出 TokenB 的数量
  - 原因：`getQuote` 函数闭包问题 + `useEffect` 依赖不正确
  - 修复：使用 `useCallback` 稳定 `getQuote` 函数
  - 优化：使用 `useRef` 保存 `swapRouter`，避免依赖问题
  - 增强：添加详细的调试日志和 500ms 防抖
  - 结果：输入金额后自动计算报价，用户体验大幅提升

### 技术特性 🛠️

- React 18 + TypeScript
- Wagmi v2 以太坊钩子
- Ethers.js v6 区块链交互
- 响应式设计
- 现代化渐变 UI
- 流畅动画效果

### 合约集成 🔗

- SwapRouter - 代币交换路由
- PositionManager - 流动性持仓管理
- PoolManager - 池子管理
- ERC20 - 代币标准

### 用户体验 💡

- 直观的费率选择界面
- 实时价格计算
- 清晰的交易流程
- 友好的错误提示
- 余额实时更新

### 样式设计 🎨

- 深色主题
- 紫粉渐变色
- 卡片式布局
- 响应式网格
- 悬停动效

---

## 费率功能详细说明

### Swap 页面

- 在交换界面顶部增加费率选择器
- 三个费率选项：0.05%, 0.30%, 1.00%
- 默认选中 0.30%
- 切换费率会自动重新获取报价
- 不同费率对应不同的流动性池

### Liquidity 页面

- 添加流动性时可选择费率层级
- 与 Swap 页面保持一致的费率选项
- 确保添加到正确的费率池

### 样式特点

- 网格布局，三个费率按钮并排
- 选中状态：渐变背景 + 阴影效果
- 悬停效果：边框高亮
- 禁用状态：半透明处理

---

## 钱包连接修复

### 问题描述

原先点击 "Connect Wallet" 按钮没有反应

### 解决方案

1. 将连接函数改为异步 async/await
2. 添加 try-catch 错误处理
3. 检查 connector 是否存在
4. 提供友好的错误提示
5. 在控制台输出详细错误信息

### 改进点

- 当没有安装 MetaMask 时给出提示
- 连接失败时显示错误信息
- 更好的用户反馈体验
